{% extends 'base.html' %}
{%load static %}

{% block title %}
    {{ request.user }}님의 리뷰
{% endblock %}

{%block css%}
    <link rel="stylesheet" type="text/css" href="{% static 'css/myreview_list.css' %}">
{% endblock %}

{% block content %}

<div id="search_page" class="position-relative overflow-hidden m-0 text-center" style="padding-left:8rem; padding-right:8rem;">
    <header class="pt-3">
        <div class="p-2 mx-auto text-center">
            <div class="page_title">My Review List</div>
            <p class="fs-5 text-muted page_info">내가 작성한 리뷰들을 찾아보세요. 작성했던 리뷰를 수정할 수 있어요!</p>
        </div>
    </header>
    <table class="table">
        <thead>
            <tr class="table_title">
                <th>카페명</th>
                <th>나의 별점</th> 
                <th>내용</th> 
                <th>작성 날짜</th>      
                <th>리뷰 수정</th>          
            </tr>
        </thead>
    <tbody>
        {% for review in my_all_review %}
            <tr>
                <td><a href="{% url 'cafe:review_list' review.cafe.id %}">{{ review.cafe }}</a></td>
                
                <td>
                {%if review.review_stars == 0.0 %}
                    <div class="rating_wrap_parents">
                        <div class="rating_wrap">
                            <div class="not_rating">
                                <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                                <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                                <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                                <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                                <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                        <div class="rating_wrap_parents">
                            <div class="rating_wrap" style="vertical-align: middle;">
                                <div class="not_rating">
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star empty_star"></i></div></div>
                                </div>
                            </div>
                            <div class="rating_wrap">
                                <div class="rating" data-rate="{{review.review_stars}}">
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star full_star"></i></div></div>
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star full_star"></i></div></div>
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star full_star"></i></div></div>
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star full_star"></i></div></div>
                                    <div class="star_wrap"><div class="star"><i class="fas fa-star full_star"></i></div></div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </td>
                <td>{{ review.content }}</td>
                <td>{{ review.created_at }}</td> 
                <td><a class="button" href="{% url 'review_update' review.id %}">수정하기</a></td>        
            </tr>
        {% endfor %}    
    </tbody>
    </table>


    
    <!-- 페이징 처리 -->
    {% if is_paginated %}
    <div class="btn-group me-2" role="group" aria-label="First group">
    <ul class="pagination" style="justify-content: space-around; font-family: RIDIBatang; color: black;">
        <li class="page-item">
            <a class="page-link" href="?type={{ type }}&q={{ q }}&page={{1}}" style="color:black;">
                처음
            </a>
        </li>
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?type={{ type }}&q={{ q }}&page={{ page_obj.previous_page_number }}" tabindex="-1" style="color:black;">
                이전
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" >
                이전
            </a>
        </li>
        {% endif %}

        {% for page in page_range %}
        <li class="page-item {% if page == page_obj.number %} activate {% endif %}">
            
            <a class="page-link" href="?type={{ type }}&q={{ q }}&page={{ page }}" style="color: black;">
                {{ page }}
            </a>
            
        </li>
        {% endfor %}

        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?type={{ type }}&q={{ q }}&page={{ page_obj.next_page_number }}" style="color: black;">
                다음
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#">
                다음
            </a>
        </li>
        {% endif %}
        <li class="page-item">
            <a class="page-link" href="?type={{ type }}&q={{ q }}&page={{page_obj.paginator.num_pages}}" style="color: black;">
                마지막
            </a>
        </li>
    </ul>
    </div>
    <div style="height:38px;">
        <span style="line-height: 38px; vertical-align: middle; font-family: RIDIBatang;">{{page_obj}}</span>
    </div>
    {% endif %}
</div>
<script>
    //카페 별점 매기기
    var rating = $('.rating'); //rating class 불러와
    
    rating.each(function() { //rating 각자마다 할 일이 있다.
        var $this = $(this); //rating을 this로 부른다.
        var targetScore = $this.attr('data-rate'); 
        var firstdigit = targetScore.split('.'); //나눠서 배열로 만듦 ex) 3.5점이면 ['3', '5']이렇게 됨

        if (firstdigit.length > 1) { //배열의 개수가 1보다 크니까 소수점이 있다는 의미
            for(var i = 0; i<firstdigit[0]; i++) { //배열 첫 번째 요소, 즉 일의 자리는 똑같이 반복문 돌리기
                $this.find('.star').eq(i).css({width:'100%'}); 
            }
            $this.find('.star').eq(firstdigit[0]).css({width:firstdigit[1]+'0%'});
        } else {
            for(var i = 0; i<targetScore; i++) { //소수점이 없으면 별점만큼 반복해서
                $this.find('.star').eq(i).css({width:'100%'}); //star 찾아서 채워주기
            }
        }
    });
</script>
{% endblock %}


